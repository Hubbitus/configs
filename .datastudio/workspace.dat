0.0.tx=SELECT *\nFROM bo_user\n/\n\nSELECT *\nFROM bo_role\n/\n\nSELECT *\nFROM bo_role_resource
10.0.tx=--EXPLAIN ANALYZE\nSELECT\n\tcontract.id\n\t, contract.bo_document_fkey\n\t, contract.bo_party_buyer_fkey\n\t, contract.bo_party_seller_fkey\n\t, contract.buyer_info_date\n\t, contract.seller_info_date\n\t, contract.buyer_inn\n\t, contract.seller_inn\n\t, contract.deal_number\n\t, contract.main_deal_number\n\t, contract.is_buyer\n\t, contract.wood_storages\n\t, contract.buyer_sign_date\n\t, contract.seller_sign_date\n\t, contract.deal_type\n\t, contract.wood_type\n\t, contract.seller_signature\n\t, contract.buyer_signature\n\t, contract.seller_thumb_print\n\t, contract.buyer_thumb_print\n\t, contract.seller_signed_by\n\t, contract.buyer_signed_by\n\t, s1.hardwood_volume AS wood_volume\n\t, doc.create_date\n\t, doc.update_date\n\t, doc.contract_num\n\t, doc.contract_start_date\n\t, doc.contract_end_date\n\t, doc.sign_date\n\t, doc.doc_type_fkey\n\t, src_sys.id AS source_system_id\n\t, src_sys.label AS source_system_label\n\t, doc.lu_land_type_fkey\n\t, doc.status\n\t, doc.signal_status \nFROM\n\tbo_contract_hardwood_deal contract\n\t\tLEFT JOIN (\n\t\t\tSELECT\n\t\t\t\tdetail.bo_contract_hardwood_fkey\n\t\t\t\t, SUM(hardwood_volume) hardwood_volume\n\t\t\tFROM\n\t\t\t\tbo_hardwood_deal_details detail\n\t\t\tGROUP BY\n\t\t\t\tdetail.bo_contract_hardwood_fkey\n\t\t) s1 ON s1.bo_contract_hardwood_fkey \= contract.id\n\t\tINNER JOIN bo_document_base doc\tON doc.id \= contract.bo_document_fkey\n\t\tINNER JOIN bo_party seller ON seller.id \= contract.bo_party_seller_fkey \n\t\tINNER JOIN bo_party buyer ON buyer.id \= contract.bo_party_buyer_fkey \n\t\tINNER JOIN bo_system src_sys \n\t\tON doc.source_system \= src_sys.id \nWHERE\n\tdoc.contract_num\='1'\n//\tAND doc.contract_start_date\=$2 \n//\tAND seller.inn\=$3 \n\tAND buyer.inn\='4712000953'\n/\n\nSELECT\n\tSUM(report_detail.hardwood_volume)\n\t, report_detail.lu_wood_breed_fkey\n\t, report_detail.wood_class_fkey\n\t, breed.breed_desc\n\t, cls.wood_class \nFROM\n\tbo_hardwood_deal_report_detail report_detail \n\t\tINNER JOIN bo_hardwood_deal_report report \n\t\tON report.id \= report_detail.bo_hardwood_deal_report_fkey \n\t\tINNER JOIN lu_wood_class cls \n\t\tON cls.id \= report_detail.wood_class_fkey \n\t\tINNER JOIN lu_wood_breed breed \n\t\tON breed.id \= report_detail.lu_wood_breed_fkey \nWHERE\n\treport.party_fkey \= $1 \n\tAND report.bo_contract_hardwood_fkey \= $2 \n\tAND report.status \= $3 \nGROUP BY\n\treport_detail.lu_wood_breed_fkey\n\t, report_detail.wood_class_fkey\n\t, breed.breed_desc\n\t, cls.wood_class\n/\n\nSELECT\n\tSUM(report_detail.hardwood_volume)\n\t, report_detail.lu_wood_breed_fkey\n\t, report_detail.wood_class_fkey\n\t, breed.breed_desc\n\t, cls.wood_class \nFROM\n\tbo_hardwood_deal_report_detail report_detail \n\t\tINNER JOIN bo_hardwood_deal_report report \n\t\tON report.id \= report_detail.bo_hardwood_deal_report_fkey \n\t\tINNER JOIN lu_wood_class cls \n\t\tON cls.id \= report_detail.wood_class_fkey \n\t\tINNER JOIN lu_wood_breed breed \n\t\tON breed.id \= report_detail.lu_wood_breed_fkey \nWHERE\n\treport.party_fkey \= 'P_187229'\n\tAND report.bo_contract_hardwood_fkey \= \n\tAND report.status \= $3 \nGROUP BY\n\treport_detail.lu_wood_breed_fkey\n\t, report_detail.wood_class_fkey\n\t, breed.breed_desc\n\t, cls.wood_class\n/\n\nSELECT\n\tSUM(report_detail.hardwood_volume)\n\t,report_detail.lu_wood_breed_fkey\n\t,report_detail.wood_class_fkey\n\t,breed.breed_desc\n\t,cls.wood_class\nFROM\n\tbo_hardwood_deal_report_detail report_detail\n\tINNER JOIN bo_hardwood_deal_report report ON (report.id \= report_detail.bo_hardwood_deal_report_fkey)\n\tINNER JOIN lu_wood_class cls ON (cls.id \= report_detail.wood_class_fkey)\n\tINNER JOIN lu_wood_breed breed ON (breed.id \= report_detail.lu_wood_breed_fkey)\nWHERE\n\treport.party_fkey \= 'P_187229'\n\tAND report.bo_contract_hardwood_fkey \= 'P_182382'\n\tAND report.status \= 2\nGROUP BY\n\treport_detail.lu_wood_breed_fkey\n\t,report_detail.wood_class_fkey\n\t,breed.breed_desc\n\t,cls.wood_class\n/\n];[partyFkey\:P_187229,dealFkey\:P_182382,status\:2,reportNumber\:0\n/\n\n\n--EXPLAIN (ANALYZE, BUFFERS)\nSELECT\n\tSUM(report_detail.hardwood_volume)\n\t,report_detail.lu_wood_breed_fkey\n\t,report_detail.wood_class_fkey\n\t,breed.breed_desc\n\t,cls.wood_class\nFROM\n\tbo_hardwood_deal_report_detail report_detail\n\tINNER JOIN bo_hardwood_deal_report report ON (report.id \= report_detail.bo_hardwood_deal_report_fkey)\n\tINNER JOIN lu_wood_class cls ON (cls.id \= report_detail.wood_class_fkey)\n\tINNER JOIN lu_wood_breed breed ON (breed.id \= report_detail.lu_wood_breed_fkey)\nWHERE\n\treport.party_fkey \= 'P_117251'\n\tAND report.bo_contract_hardwood_fkey \= 'P_663'\n\tAND report.status \= 2\nGROUP BY\n\treport_detail.lu_wood_breed_fkey\n\t,report_detail.wood_class_fkey\n\t,breed.breed_desc\n\t,cls.wood_class\n/\n\n-- 07.05.2016 18\:13\nCREATE INDEX tmp__1 ON bo_hardwood_deal_report_detail (bo_hardwood_deal_report_fkey, wood_class_fkey, lu_wood_breed_fkey, hardwood_volume)\n/\n\n
11.0.tx=EXPLAIN (ANALYZE, BUFFERS)\nSELECT\n\tSUM(report_detail.hardwood_volume)\n\t,report_detail.lu_wood_breed_fkey\n\t,report_detail.wood_class_fkey\n\t,breed.breed_desc\n\t,cls.wood_class\nFROM\n\tbo_hardwood_deal_report_detail report_detail\n\tINNER JOIN bo_hardwood_deal_report report ON (report.id \= report_detail.bo_hardwood_deal_report_fkey)\n\tINNER JOIN lu_wood_class cls ON (cls.id \= report_detail.wood_class_fkey)\n\tINNER JOIN lu_wood_breed breed ON (breed.id \= report_detail.lu_wood_breed_fkey)\nWHERE\n\treport.party_fkey \= 'P_117251'\n\tAND report.bo_contract_hardwood_fkey \= 'P_663'\n\tAND report.status \= 2\nGROUP BY\n\treport_detail.lu_wood_breed_fkey\n\t,report_detail.wood_class_fkey\n\t,breed.breed_desc\n\t,cls.wood_class\n/
14.0.tx=SELECT DISTINCT\nd.create_date AS "\u0414\u0430\u0442\u0430 \u0437\u0430\u043D\u0435\u0441\u0435\u043D\u0438\u044F",\nCASE WHEN d.status\='1' THEN '\u0427\u0435\u0440\u043D\u043E\u0432\u0438\u043A'\nWHEN d.status\='2' THEN '\u041F\u043E\u0434\u043F\u0438\u0441\u0430\u043D'\nWHEN d.status\='3' THEN '\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u0443\u0435\u0442\u0441\u044F'\nWHEN d.status\='4' THEN '\u0423\u0434\u0430\u043B\u0435\u043D'\nELSE '' END AS "\u0421\u0442\u0430\u0442\u0443\u0441 \u0434\u043E\u043A\u0443\u043C\u0435\u043D\u0442\u0430",\nc.main_deal_number AS "\u041D\u043E\u043C\u0435\u0440 \u0434\u0435\u043A\u043B\u0430\u0440\u0430\u0446\u0438\u0438", \ns_pt.type AS "\u0422\u0438\u043F \u043F\u0440\u043E\u0434\u0430\u0432\u0446\u0430",\nCASE WHEN s.party_type_fkey in (0, 2) THEN s.party_name \nWHEN s.party_type_fkey in (1, 3) THEN concat(s.person_last_name, ' ', s.person_first_name,' ', s.person_mid_name) \nELSE '' END AS "\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0440\u043E\u0434\u0430\u0432\u0446\u0430",\nc.seller_inn AS "\u0418\u041D\u041D \u043F\u0440\u043E\u0434\u0430\u0432\u0446\u0430",\nb_pt.type AS "\u0422\u0438\u043F \u043F\u043E\u043A\u0443\u043F\u0430\u0442\u0435\u043B\u044F",\nCASE WHEN b.party_type_fkey in (0, 2) THEN b.party_name \nWHEN b.party_type_fkey in (1, 3) THEN concat(b.person_last_name, ' ', b.person_first_name,' ', b.person_mid_name) \nELSE '' END AS "\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u043E\u043A\u0443\u043F\u0430\u0442\u0435\u043B\u044F", \nb.inn AS "\u0418\u041D\u041D \u043F\u043E\u043A\u0443\u043F\u0430\u0442\u0435\u043B\u044F",\nd.contract_num AS "\u041D\u043E\u043C\u0435\u0440 \u0434\u043E\u0433\u043E\u0432\u043E\u0440\u0430", \nd.contract_start_date AS "\u0414\u0430\u0442\u0430 \u043F\u043E\u0434\u043F\u0438\u0441\u0430\u043D\u0438\u044F", \nc.seller_sign_date AS "\u041F\u043E\u0434\u043F\u0438\u0441\u0430\u043D\u043E \u043F\u0440\u043E\u0434\u0430\u0432\u0446\u043E\u043C",\nc.buyer_sign_date AS "\u041F\u043E\u0434\u043F\u0438\u0441\u0430\u043D\u043E \u043F\u043E\u043A\u0443\u043F\u0430\u0442\u0435\u043B\u0435\u043C",\nCASE WHEN c.seller_signature<>'' THEN '1'\nELSE '0' END AS "\u041F\u043E\u0434\u043F\u0438\u0441\u0430\u043D\u043E \u042D\u041F \u043F\u0440\u043E\u0434\u0430\u0432\u0446\u043E\u043C",\nCASE WHEN c.buyer_signature<>'' THEN '1'\nELSE '0' END AS "\u041F\u043E\u0434\u043F\u0438\u0441\u0430\u043D\u043E \u042D\u041F \u043F\u043E\u043A\u0443\u043F\u0430\u0442\u0435\u043B\u0435\u043C"\nFROM bo_contract_hardwood_deal c \nINNER JOIN bo_document_base d ON c.bo_document_fkey \= d.id \nINNER JOIN bo_party s ON c.bo_party_seller_fkey \= s.id \nINNER JOIN bo_party b ON c.bo_party_buyer_fkey \= b.id \nINNER JOIN lu_party_type s_pt ON s_pt.id \= s.party_type_fkey\nINNER JOIN lu_party_type b_pt ON b_pt.id \= b.party_type_fkey\nWHERE d.create_date >\= '05.01.2016'
2.0.tx=--CREATE OR REPLACE VIEW oa_contract_lease AS\nSELECT DISTINCT\n    w.id AS contract_id,\n    CASE\n\t\tWHEN p.party_type_fkey \= 3\n\t\t\tTHEN ''\n\t\tELSE p.inn\n\tEND AS inn\n\t,b.contract_start_date as deal_date\n\t,c.id as bo_const_entity_fkey\n\t,c.name as bo_const_entity_name\n\t,f.id as bo_forestry_fkey\n\t,f.name as bo_forestry_name\n\t,sf.id as bo_sub_forestry_fkey\n\t,sf.name as bo_sub_forestry_name\n\t,t.id as bo_tract_fkey\n\t,t.name as bo_tract_name\n\t,CASE\n\t\tWHEN p.party_type_fkey \= 3\n\t\t\tTHEN '\u0424\u0438\u0437\u0438\u0447\u0435\u0441\u043A\u043E\u0435 \u043B\u0438\u0446\u043E'\n\t\tWHEN p.party_type_fkey \= 1\n\t\t\tTHEN p.person_last_name || ' ' || p.person_first_name || ' ' || p.person_mid_name\n\t\tELSE p.party_name\n\tEND as company_name\n\t,le.forest_block_num as forest_block_num\n\t,(\n\t\tCOALESCE(w.unclassified_volume, 0)\n\t\t+ COALESCE(w.coniferous_volume, 0)\n\t\t+ COALESCE(w.hardwood_volume, 0)\n\t\t+ COALESCE(w.softwood_volume, 0)\n\t) AS wood_volume\nFROM\n\tbo_contract_lease w\n    JOIN bo_document_base b ON (w.bo_document_fkey \= b.id)\n    JOIN bo_party p ON (w.bo_party_fkey \= p.id)\n    JOIN bo_state_authority s ON (w.bo_state_authority_fkey \= s.id)\n    JOIN bo_constituent_entity c ON (s.bo_constituent_entity_fkey \= c.id)\n    JOIN rel_contract_lease_woodlot rwl ON (rwl.bo_contract_lease_fkey \= w.id)\n    JOIN bo_woodlot l ON (rwl.bo_woodlot_fkey \= l.id)\n    JOIN bo_woodlot_elements le ON (le.bo_woodlot_fkey \= l.id)\n    LEFT JOIN bo_forestry f ON (le.bo_forestry_fkey \= f.id)\n    LEFT JOIN bo_sub_forestry sf ON (le.bo_sub_forestry_fkey \= sf.id)\n    LEFT JOIN bo_tract t ON (le.bo_tract_fkey \= t.id)\nWHERE\n\tb.status \= 2\n\tAND b.lu_land_type_fkey \= 1\n\tAND b.contract_end_date > current_date\n/\n\nDROP VIEW oa_contract_lease\n/\n\nCREATE OR REPLACE VIEW oa_contract_lease AS\nSELECT DISTINCT\n    w.id AS contract_id\n--    ,CASE\n--\t\tWHEN p.party_type_fkey \= 3\n--\t\t\tTHEN ''\n--\t\tELSE p.inn\n--\tEND AS inn\n\t,b.contract_start_date as deal_date\n--\t,c.id as bo_const_entity_fkey\n--\t,c.name as bo_const_entity_name\n--\t,f.id as bo_forestry_fkey\n--\t,f.name as bo_forestry_name\n--\t,sf.id as bo_sub_forestry_fkey\n--\t,sf.name as bo_sub_forestry_name\n--\t,t.id as bo_tract_fkey\n--\t,t.name as bo_tract_name\n--\t,CASE\n--\t\tWHEN p.party_type_fkey \= 3\n--\t\t\tTHEN '\u0424\u0438\u0437\u0438\u0447\u0435\u0441\u043A\u043E\u0435 \u043B\u0438\u0446\u043E'\n--\t\tWHEN p.party_type_fkey \= 1\n--\t\t\tTHEN p.person_last_name || ' ' || p.person_first_name || ' ' || p.person_mid_name\n--\t\tELSE p.party_name\n--\tEND as company_name\n--\t,le.forest_block_num as forest_block_num\n--\t,(\n--\t\tCOALESCE(w.unclassified_volume, 0)\n--\t\t+ COALESCE(w.coniferous_volume, 0)\n--\t\t+ COALESCE(w.hardwood_volume, 0)\n--\t\t+ COALESCE(w.softwood_volume, 0)\n--\t) AS wood_volume\nFROM\n\tbo_contract_lease w\n    JOIN bo_document_base b ON (w.bo_document_fkey \= b.id)\n    JOIN bo_party p ON (w.bo_party_fkey \= p.id)\n    JOIN bo_state_authority s ON (w.bo_state_authority_fkey \= s.id)\n    JOIN bo_constituent_entity c ON (s.bo_constituent_entity_fkey \= c.id)\n    JOIN rel_contract_lease_woodlot rwl ON (rwl.bo_contract_lease_fkey \= w.id)\n    JOIN bo_woodlot l ON (rwl.bo_woodlot_fkey \= l.id)\n--    JOIN bo_woodlot_elements le ON (le.bo_woodlot_fkey \= l.id)\n--    LEFT JOIN bo_forestry f ON (le.bo_forestry_fkey \= f.id)\n--    LEFT JOIN bo_sub_forestry sf ON (le.bo_sub_forestry_fkey \= sf.id)\n--    LEFT JOIN bo_tract t ON (le.bo_tract_fkey \= t.id)\nWHERE\n\tb.status \= 2\n\tAND b.lu_land_type_fkey \= 1\n\tAND b.contract_end_date > current_date\n/\n\n
3.0.tx=--EXPLAIN (ANALYZE, VERBOSE, BUFFERS)\nEXPLAIN ANALYZE\nWITH _view AS (\nSELECT\n    w.id AS contract_id\n\t,b.contract_start_date as deal_date\n--\t,p.inn\n--    ,CASE\n--\t\tWHEN p.party_type_fkey \= 3\n--\t\t\tTHEN ''\n--\t\tELSE p.inn\n--\tEND AS inn\n--\t,c.id as bo_const_entity_fkey\n--\t,c.name as bo_const_entity_name\n--\t,f.id as bo_forestry_fkey\n--\t,f.name as bo_forestry_name\n--\t,sf.id as bo_sub_forestry_fkey\n--\t,sf.name as bo_sub_forestry_name\n--\t,t.id as bo_tract_fkey\n--\t,t.name as bo_tract_name\n--\t,CASE\n--\t\tWHEN p.party_type_fkey \= 3\n--\t\t\tTHEN '\u0424\u0438\u0437\u0438\u0447\u0435\u0441\u043A\u043E\u0435 \u043B\u0438\u0446\u043E'\n--\t\tWHEN p.party_type_fkey \= 1\n--\t\t\tTHEN p.person_last_name || ' ' || p.person_first_name || ' ' || p.person_mid_name\n--\t\tELSE p.party_name\n--\tEND as company_name\n--\t,le.forest_block_num as forest_block_num\n--\t,(\n--\t\tCOALESCE(w.unclassified_volume, 0)\n--\t\t+ COALESCE(w.coniferous_volume, 0)\n--\t\t+ COALESCE(w.hardwood_volume, 0)\n--\t\t+ COALESCE(w.softwood_volume, 0)\n--\t) AS wood_volume\n--\t,w.total_wood_volume\nFROM\n\tbo_contract_lease w\n    JOIN bo_document_base b ON (w.bo_document_fkey \= b.id)\n    JOIN bo_party p ON (p.id \= w.bo_party_fkey)\n--    JOIN bo_state_authority s ON (w.bo_state_authority_fkey \= s.id)\n--    JOIN bo_constituent_entity c ON (s.bo_constituent_entity_fkey \= c.id)\n--    JOIN rel_contract_lease_woodlot rwl ON (rwl.bo_contract_lease_fkey \= w.id)\n--    JOIN bo_woodlot_elements le ON (le.bo_woodlot_fkey \= rwl.bo_woodlot_fkey)\n--    LEFT JOIN bo_forestry f ON (le.bo_forestry_fkey \= f.id)\n--    LEFT JOIN bo_sub_forestry sf ON (le.bo_sub_forestry_fkey \= sf.id)\n--    LEFT JOIN bo_tract t ON (le.bo_tract_fkey \= t.id)\nWHERE\n\tb.status \= 2\n\tAND b.lu_land_type_fkey \= 1\n\tAND b.contract_end_date > current_date\n)\nSELECT\n\t1\n--\t,r.inn\n\t,r.deal_date\n--\t,r.company_name\n--\t,string_agg(DISTINCT r.bo_const_entity_name, '; ') const_entity_name\n--\t,string_agg(DISTINCT r.bo_forestry_name, '; ') forestry_name\n--\t,string_agg(DISTINCT r.bo_sub_forestry_name, '; ') sub_forestry_name\n--\t,string_agg(DISTINCT r.bo_tract_name, '; ') tract_name\n--\t,string_agg(DISTINCT r.forest_block_num, '; ') forest_block_num\n--\t,r.wood_volume\nFROM\n\t_view r\nGROUP BY\n\t r.contract_id\n--\t,r.inn\n\t,r.deal_date\n--\t,r.wood_volume\n--\t,r.company_name\n-- ORDER BY r.deal_date DESC NULLS LAST\n-- offset $1 limit $2\nLIMIT 20;\n/\n\nCREATE INDEX tmp__1 ON bo_contract_lease (bo_document_fkey, bo_party_fkey, bo_state_authority_fkey)\n/\nDROP INDEX tmp__1\n/\n\nCREATE INDEX tmp__2 ON bo_party ((CASE\n\t\tWHEN party_type_fkey \= 3\n\t\t\tTHEN ''\n\t\tELSE inn\n\tEND));\n/\n\nCREATE INDEX tmp__3 ON bo_forestry (id, name)\n/\nDROP INDEX tmp__3\n/\n\nCREATE INDEX tmp__4 ON bo_contract_lease ((\n\tCOALESCE(unclassified_volume, 0)\n\t+ COALESCE(coniferous_volume, 0)\n\t+ COALESCE(hardwood_volume, 0)\n\t+ COALESCE(softwood_volume, 0)\n))\n\n/\n\n-- create virtual column\n-- http\://momjian.us/main/blogs/pgblog/2013.html\#April_1_2013\nCREATE FUNCTION total_wood_volume(bo_contract_lease) RETURNS float AS $$\n\tSELECT COALESCE($1.unclassified_volume, 0) + COALESCE($1.coniferous_volume, 0) + COALESCE($1.hardwood_volume, 0) + COALESCE($1.softwood_volume, 0)\n$$ LANGUAGE SQL;\n/\n\nCREATE INDEX tmp__5 ON bo_contract_lease (total_wood_volume(bo_contract_lease))\n/\n\nCREATE INDEX tmp__6 ON bo_contract_lease (bo_document_fkey, bo_party_fkey, bo_state_authority_fkey, total_wood_volume(bo_contract_lease))\n/\n\nCREATE INDEX tmp__7 ON bo_document_base(id, status, lu_land_type_fkey, contract_end_date)\n/\n\nCREATE INDEX tmp__8 ON bo_document_base(status, lu_land_type_fkey, contract_end_date)\n/\n\nEXPLAIN ANALYZE\nSELECT\n    w.id AS contract_id\n\t,b.contract_start_date as deal_date\n--\t,p.inn\n--    ,CASE\n--\t\tWHEN p.party_type_fkey \= 3\n--\t\t\tTHEN ''\n--\t\tELSE p.inn\n--\tEND AS inn\n--\t,c.id as bo_const_entity_fkey\n--\t,c.name as bo_const_entity_name\n--\t,f.id as bo_forestry_fkey\n--\t,f.name as bo_forestry_name\n--\t,sf.id as bo_sub_forestry_fkey\n--\t,sf.name as bo_sub_forestry_name\n--\t,t.id as bo_tract_fkey\n--\t,t.name as bo_tract_name\n--\t,CASE\n--\t\tWHEN p.party_type_fkey \= 3\n--\t\t\tTHEN '\u0424\u0438\u0437\u0438\u0447\u0435\u0441\u043A\u043E\u0435 \u043B\u0438\u0446\u043E'\n--\t\tWHEN p.party_type_fkey \= 1\n--\t\t\tTHEN p.person_last_name || ' ' || p.person_first_name || ' ' || p.person_mid_name\n--\t\tELSE p.party_name\n--\tEND as company_name\n--\t,le.forest_block_num as forest_block_num\n--\t,(\n--\t\tCOALESCE(w.unclassified_volume, 0)\n--\t\t+ COALESCE(w.coniferous_volume, 0)\n--\t\t+ COALESCE(w.hardwood_volume, 0)\n--\t\t+ COALESCE(w.softwood_volume, 0)\n--\t) AS wood_volume\n--\t,w.total_wood_volume\nFROM\n\tbo_contract_lease w\n    JOIN bo_document_base b ON (w.bo_document_fkey \= b.id)\n--    JOIN bo_party p ON (p.id \= w.bo_party_fkey)\n--    JOIN bo_state_authority s ON (w.bo_state_authority_fkey \= s.id)\n--    JOIN bo_constituent_entity c ON (s.bo_constituent_entity_fkey \= c.id)\n--    JOIN rel_contract_lease_woodlot rwl ON (rwl.bo_contract_lease_fkey \= w.id)\n--    JOIN bo_woodlot_elements le ON (le.bo_woodlot_fkey \= rwl.bo_woodlot_fkey)\n--    LEFT JOIN bo_forestry f ON (le.bo_forestry_fkey \= f.id)\n--    LEFT JOIN bo_sub_forestry sf ON (le.bo_sub_forestry_fkey \= sf.id)\n--    LEFT JOIN bo_tract t ON (le.bo_tract_fkey \= t.id)\nWHERE\n\tb.status \= 2\n\tAND b.lu_land_type_fkey \= 1\n\tAND b.contract_end_date > current_date\n--GROUP BY\n--\t w.id\n----\t,r.inn\n--\t,b.contract_start_date\nLIMIT 20
5.0.tx=SELECT n.nspname as "Schema",\n  pg_catalog.format_type(t.oid, NULL) AS "Name",\n  pg_catalog.obj_description(t.oid, 'pg_type') as "Description"\n\t,t.*\nFROM pg_catalog.pg_type t\n     LEFT JOIN pg_catalog.pg_namespace n ON n.oid \= t.typnamespace\nWHERE (t.typrelid \= 0 OR (SELECT c.relkind \= 'c' FROM pg_catalog.pg_class c WHERE c.oid \= t.typrelid))\n  AND NOT EXISTS(SELECT 1 FROM pg_catalog.pg_type el WHERE el.oid \= t.typelem AND el.typarray \= t.oid)\n  AND pg_catalog.pg_type_is_visible(t.oid)\nORDER BY 1, 2;\n\n/\n\nSELECT\n\tNULL AS TABLE_CAT\n\t, n.nspname AS TABLE_SCHEM\n\t, C.relname AS TABLE_NAME\n\t,\n\tCASE n.nspname ~ '^pg_'\n\t\tOR n.nspname \= 'information_schema'\n\t\tWHEN TRUE\n\t\tTHEN\n\t\tCASE\n\t\t\tWHEN n.nspname \= 'pg_catalog'\n\t\t\tOR n.nspname \= 'information_schema'\n\t\t\tTHEN\n\t\t\tCASE C.relkind\n\t\t\t\tWHEN 'r'\n\t\t\t\tTHEN 'SYSTEM TABLE'\n\t\t\t\tWHEN 'v'\n\t\t\t\tTHEN 'SYSTEM VIEW'\n\t\t\t\tWHEN 'i'\n\t\t\t\tTHEN 'SYSTEM INDEX'\n\t\t\t\tELSE NULL\n\t\t\tEND\n\t\t\tWHEN n.nspname \= 'pg_toast'\n\t\t\tTHEN\n\t\t\tCASE C.relkind\n\t\t\t\tWHEN 'r'\n\t\t\t\tTHEN 'SYSTEM TOAST TABLE'\n\t\t\t\tWHEN 'i'\n\t\t\t\tTHEN 'SYSTEM TOAST INDEX'\n\t\t\t\tELSE NULL\n\t\t\tEND\n\t\t\tELSE\n\t\t\tCASE C.relkind\n\t\t\t\tWHEN 'r'\n\t\t\t\tTHEN 'TEMPORARY TABLE'\n\t\t\t\tWHEN 'i'\n\t\t\t\tTHEN 'TEMPORARY INDEX'\n\t\t\t\tWHEN 'S'\n\t\t\t\tTHEN 'TEMPORARY SEQUENCE' \n\t\t\t\tWHEN 'v' \n\t\t\t\tTHEN 'TEMPORARY VIEW' \n\t\t\t\tELSE NULL \n\t\t\tEND \n\t\tEND \n\t\tWHEN FALSE \n\t\tTHEN \n\t\tCASE C.relkind \n\t\t\tWHEN 'r' \n\t\t\tTHEN 'TABLE' \n\t\t\tWHEN 'i' \n\t\t\tTHEN 'INDEX' \n\t\t\tWHEN 'S' \n\t\t\tTHEN 'SEQUENCE' \n\t\t\tWHEN 'v' \n\t\t\tTHEN 'VIEW' \n\t\t\tWHEN 'c' \n\t\t\tTHEN 'TYPE' \n\t\t\tWHEN 'f' \n\t\t\tTHEN 'FOREIGN TABLE' \n\t\t\tWHEN 'm' \n\t\t\tTHEN 'MATERIALIZED VIEW' \n\t\t\tELSE NULL \n\t\tEND \n\t\tELSE NULL \n\tEND AS TABLE_TYPE\n\t, d.description AS REMARKS \nFROM\n\tpg_catalog.pg_namespace n\n\t, pg_catalog.pg_class C \n\t\tLEFT JOIN pg_catalog.pg_description d \n\t\tON (C.oid \= d.objoid \n\t\tAND d.objsubid \= 0) \n\t\tLEFT JOIN pg_catalog.pg_class dc \n\t\tON (d.classoid\=dc.oid \n\t\tAND dc.relname\='pg_class') \n\t\tLEFT JOIN pg_catalog.pg_namespace dn \n\t\tON (dn.oid\=dc.relnamespace \n\t\tAND dn.nspname\='pg_catalog') \nWHERE\n\tC.relnamespace \= n.oid\n--\tAND C.relname LIKE 'OPENL_JCR_CACHE'\n\tAND C.relname LIKE 'openl_jcr_cache'\n--\tAND (\n--\t\tFALSE OR ( C.relkind \= 'r' \n--\tAND n.nspname \!~ '^pg_' \n--\tAND n.nspname <> 'information_schema' ) ) \nORDER BY\n\tTABLE_TYPE\n\t,TABLE_SCHEM\n\t,TABLE_NAME\n/\n\nDROP TABLE openl_jcr_cache\n/\n\nSELECT * FROM openl_jcr_cache\n/\n\nUPDATE openl_jcr_cache\nSET timestamp \= NOW()\n/\n\nSELECT ID, DATA FROM OPENL_JCR_CACHE WHERE ID \= '1'\n/\n\nSELECT *\nFROM "OPENL_JCR_CACHE"\n/\n\nSELECT *\nFROM meta_model\n/\n\n\nSELECT *\nFROM rel_wood_breed_tnved_class\n/\n\nSELECT\n\tb.*, rel.lu_wood_class_fkey\nFROM\n\tlu_wood_breed b\n\tJOIN rel_wood_breed_wood_class rel ON (rel.lu_wood_breed_fkey \= b.id)\n--\tJOIN lu_wood_class c ON (rel.lu_wood_class_fkey \= c.id)\nORDER BY\n\tb.id, rel.lu_wood_class_fkey\n/\n\nSELECT\n\tb.*, array_agg(rel.lu_tnved_class_fkey)\nFROM\n\tlu_wood_breed b\n\tJOIN rel_wood_breed_tnved_class rel ON (rel.lu_wood_breed_fkey \= b.id)\nGROUP BY\n\tb.id, b.breed_desc, b.create_date, b.update_date, b.source_system, b.source_key, b.created_by, b.updated_by, b.deprecated\nORDER BY\n\tb.id\n/\n\nSELECT *\nFROM lu_wood_breed\n/\n
6.0.tx=select\n\t--startOpt fullCount\n\tcount(*) over() full_count,\n\t--endOpt fullCount\n\tr.company_name,\n\tr.inn,\n\tr.deal_date,\n\tstring_agg(DISTINCT r.bo_const_entity_name, '; ') const_entity_name,\n\tstring_agg(DISTINCT r.bo_forestry_name, '; ') forestry_name,\n\tstring_agg(DISTINCT r.bo_sub_forestry_name, '; ') sub_forestry_name,\n\tstring_agg(DISTINCT r.bo_tract_name, '; ') tract_name,\n\tstring_agg(DISTINCT r.forest_block_num, '; ') forest_block_num,\n\tr.wood_volume\nfrom oa_contract_lease r\n--startOpt where\nwhere 1\=1\n--endOpt where\n--startOpt constituentEntityId\n\tand r.bo_const_entity_fkey \= 24 -- \u041A\u0440\u0430\u0441\u043D\u043E\u044F\u0440\u0441\u043A\u0438\u0439 \u043A\u0440\u0430\u0439\n--endOpt constituentEntityId\n--startOpt inn\n\tand r.inn \= '7840346335'\n--endOpt inn\ngroup by r.contract_id, r.inn, r.deal_date, r.wood_volume, r.company_name\norder by r.deal_date desc nulls last\n-- offset \:offset limit \:limit\n/\n\nSELECT *\nFROM bo_constituent_entity\n/\n\n        SELECT row_to_json(t)\n        FROM (\n                SELECT\n                        CEIL(SUM(pg_total_relation_size(C.oid)) * 1.65) as sum_size, pg_size_pretty(SUM(pg_total_relation_size(C.oid)) * 1.65) as sum_size_pretty\n                FROM\n                        pg_class C\n                        LEFT JOIN pg_namespace N ON (N.oid \= C.relnamespace)\n                WHERE 1\=1\n//\t\t\t\t\tnspname IN ('unidata')\n\t\t\t\t\tAND nspname || '.' || relname NOT IN ('history.logged_actions')\n        ) t\n/\n\nSELECT\n                        CEIL(SUM(pg_total_relation_size(C.oid)) * 1.65) as sum_size, pg_size_pretty(SUM(pg_total_relation_size(C.oid)) * 1.65) as sum_size_pretty\n                FROM\n                        pg_class C\n                        LEFT JOIN pg_namespace N ON (N.oid \= C.relnamespace)\n                WHERE 1\=1\n//\t\t\t\t\tnspname IN ('unidata')\n\t\t\t\t\tAND nspname || '.' || relname NOT IN ('history.logged_actions')\n/\n\nSELECT\n\t\tnspname, pg_total_relation_size(C.oid) as size, pg_size_pretty(pg_total_relation_size(C.oid)) as sum_size_pretty\n\t\t,C.*\nFROM\n\t\tpg_class C\n\t\tLEFT JOIN pg_namespace N ON (N.oid \= C.relnamespace)\nWHERE 1\=1\n//\t\t\t\t\tnspname IN ('unidata')\n\tAND nspname || '.' || relname NOT IN ('history.logged_actions')
