1.0.tx=SELECT *\nFROM\n\tbo_contract_plants_sale c\n\tJOIN bo_document_base b ON (b.id \= c.bo_document_fkey)\nWHERE b.update_date >\= timestamp '2014-06-22T00\:00\:00.000+03\:00'\n/\n\nSELECT timestamp '2014-06-22T00\:00\:00.000+03\:00'\n/\n\nEXPLAIN (ANALYZE, BUFFERS)\nSELECT *\nFROM bo_system
2.0.tx=CREATE TABLE history.alo_table_oids(\n\talo_table_oid integer,\n\ttablename text\n)\n\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(597229,'lu_production_calendar')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(1550156,'bo_contract_hardwood_deal_bak')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(573350,'bo_document_signal_bak_2015_11_14')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(390360,'lu_status')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(1024899,'lu_forest_usage_type')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(643040,'bo_tract_bak_eg1750')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(1559756,'rel_declaration_to_element_bak_eg1967')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(1024889,'lu_wood_volume_units')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(1024911,'bo_report_period')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(1024921,'bo_forest_providing')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(1024981,'rel_sublease')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(1742828,'rel_user_role_back_11_02_16')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(2041876,'tmp__eg_2009_bak_2016_03_03')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(1024999,'rel_wood_breed_wood_class')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(1849252,'rep_test')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(1025019,'rel_wood_breed_tnved_class')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(390718,'egais_pending_operations')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279094,'bo_user_org_detail')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198149,'bo_contract_report')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198319,'lu_wood_sort')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198331,'lu_woodlot_id_type')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198337,'rel_contract_lease_woodlot')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198343,'rel_contract_lease_woodlot_bak')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198349,'rel_contract_permanent_woodlot')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198355,'rel_declaration_to_element')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198234,'bo_woodlot')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279583,'lu_user_access_level')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(280576,'rel_hardwood_deal_contract')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(390285,'egais_system_session_stats')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(280520,'bo_hardwood_deal_report')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(441764,'lu_country')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(441729,'lu_reason_type')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(441782,'bo_user_stats')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(280649,'bo_system')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(484797,'bo_report_meta')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279788,'lu_land_type')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(280528,'bo_hardwood_deal_report_detail')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(484812,'bo_print_form_meta')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(484781,'bo_document_signal')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198222,'bo_sub_forestry')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198167,'bo_federal_district')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198216,'bo_state_authority')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(557012,'lu_party_special_category')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(557050,'qrtz_job_details')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(557071,'qrtz_simple_triggers')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(557084,'qrtz_cron_triggers')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(557097,'qrtz_simprop_triggers')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279074,'schema_version')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(557058,'qrtz_triggers')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(1853314,'tmp_doc')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(557110,'qrtz_blob_triggers')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(557123,'qrtz_calendars')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(557131,'qrtz_paused_trigger_grps')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(557136,'qrtz_fired_triggers')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(557144,'qrtz_scheduler_state')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(557149,'qrtz_locks')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(1853441,'tmp_doc_base')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(557174,'alpha_auth_token')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198313,'lu_wood_class')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(484760,'lu_tnved_class')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279558,'password_reset_token')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279144,'auth_token')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198113,'bo_contract_forest_declaration')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198131,'bo_contract_lease')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198125,'bo_contract_hardwood_deal')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198107,'bo_constituent_entity')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198143,'bo_contract_plants_sale')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198137,'bo_contract_permanent')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198119,'bo_contract_forest_works')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198185,'bo_labels')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198155,'bo_document_base')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198173,'bo_forestry')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198209,'bo_party')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198179,'bo_hardwood_deal_details')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279174,'bo_user')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198228,'bo_tract')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198197,'bo_metropolitan_borough')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279104,'bo_role')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279134,'bo_role_resource')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198289,'lu_party_type')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198307,'lu_wood_breed')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279154,'lu_filter_type')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198295,'lu_person_doc_type')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279306,'lu_right_granting_type')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279124,'lu_user_type')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198361,'rel_report_to_element')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198246,'bo_woodlot_ids')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198277,'lu_doc_type')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(198240,'bo_woodlot_elements')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279276,'rel_forestry_metropolitan_borough')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279164,'rel_role_filter_type')\n/\nINSERT INTO history.alo_table_oids (alo_table_oid,tablename) VALUES(279114,'rel_user_role')\n/\n\nCREATE INDEX hostory
3.0.tx=SELECT *\nFROM bo_contract_hardwood_deal d\n\tJOIN bo_document_base b ON (b.id \= d.bo_document_fkey)\n\tJOIN rel_hardwood_deal_contract rel ON (rel.bo_hardwood_deal_fkey \= d.id)\n\tJOIN bo_document_base und ON (und.id \= rel.bo_document_underlying_fkey)\nWHERE d.id \= 'P_17766'\n/\n\nSELECT *\nFROM bo_contract_plants_sale ps\n\tJOIN bo_document_base b ON (b.id \= ps.bo_document_fkey)\nWHERE\n\tb.contract_num \= '498'\n\tAND ps.id \= 'P_539685'\n/\n\n-- Unified way obtain table name\nSELECT\n\tCOALESCE(aoid.tablename, relid\:\:regclass\:\:text) as table_name\n\t,relid\:\:regclass\:\:text as rlh_table_name\n\t,aoid.tablename as alo_table_name\n\t,ACTION\n\t,*\nFROM\n\thistory.logged_actions\n\tLEFT JOIN history.alo_table_oids aoid ON (aoid.alo_table_oid \= relid)\nWHERE\n\trow_data->'id'\:\:text \= 'P_539685'\n/\n\nSELECT\n\tCOALESCE(aoid.tablename, relid\:\:regclass\:\:text) as table_name\n\t,relid\:\:regclass\:\:text as rlh_table_name\n\t,aoid.tablename as alo_table_name\n\t,ACTION\n\t,*\nFROM\n\thistory.logged_actions\n\tLEFT JOIN history.alo_table_oids aoid ON (aoid.alo_table_oid \= relid)\nWHERE\n\t(\n\t\t'bo_contract_plants_sale' \= COALESCE(aoid.tablename, relid\:\:regclass\:\:text)\n\t\tAND row_data->'id'\:\:text \= 'P_539685'\n\t)\n\tOR\n\t(\n\t\t'bo_document_base' \= COALESCE(aoid.tablename, relid\:\:regclass\:\:text)\n\t\tAND row_data->'id'\:\:text \= 'P_2059988'\n\t)\n/\n\nSELECT\n\tCOALESCE(aoid.tablename, relid\:\:regclass\:\:text) as table_name\n\t,relid\:\:regclass\:\:text as rlh_table_name\n\t,aoid.tablename as alo_table_name\n\t,ACTION\n\t,*\nFROM\n\thistory.logged_actions\n\tLEFT JOIN history.alo_table_oids aoid ON (aoid.alo_table_oid \= relid)\nWHERE\n//\trow_data->'main_deal_number'\:\:text \= '0001004322012079430201220302'\n\trow_data->'bo_contract_hardwood_fkey'\:\:text \= 'P_276594'\n/\n\n\nSELECT\n\trelid\:\:regclass\n\t,action\n\t,*\nFROM history.logged_actions\nWHERE\n\trelid \= 'rel_hardwood_deal_contract'\:\:regclass\n\tAND row_data->'bo_hardwood_deal_fkey' \= 'P_17766'\nORDER BY\n\taction_tstamp_stm\n/\n\nSELECT\n COALESCE(aoid.tablename, relid\:\:regclass\:\:text) as table_name\n ,relid\:\:regclass\:\:text as rlh_table_name\n ,aoid.tablename as alo_table_name\n ,ACTION\n ,*\nFROM\n history.logged_actions\n LEFT JOIN history.alo_table_oids aoid ON (aoid.alo_table_oid \= relid)\n --fetch first 300 rows only\nWHERE\n (\n  'rel_hardwood_deal_contract' \= COALESCE(aoid.tablename, relid\:\:regclass\:\:text)\n   AND row_data->'bo_hardwood_deal_fkey' \= 'P_17766'\n )\n/\n\n\nSELECT\n\tCOALESCE(aoid.tablename, relid\:\:regclass\:\:text) as table_name\n\t,relid\:\:regclass\:\:text as rlh_table_name\n\t,aoid.tablename as alo_table_name\n\t,ACTION\n\t,*\nFROM\n\thistory.logged_actions\n\tLEFT JOIN history.alo_table_oids aoid ON (aoid.alo_table_oid \= relid)\nWHERE\n\t(\n\t\t'bo_contract_hardwood_deal' \= COALESCE(aoid.tablename, relid\:\:regclass\:\:text)\n\t\tAND row_data->'id'\:\:text \= 'P_214499'\n\t)\n// OR\n// (\n//  'bo_document_base' \= COALESCE(aoid.tablename, relid\:\:regclass\:\:text)\n//  AND row_data->'id'\:\:text \= 'P_2342247'\n// )\n/\n\nSELECT\n\tCOALESCE(aoid.tablename, relid\:\:regclass\:\:text) as table_name\n\t,relid\:\:regclass\:\:text as rlh_table_name\n\t,aoid.tablename as alo_table_name\n\t,ACTION\n\t,*\nFROM\n\thistory.logged_actions\n\tLEFT JOIN history.alo_table_oids aoid ON (aoid.alo_table_oid \= relid)\nWHERE\n\t(\n\t\t'bo_contract_hardwood_deal' \= COALESCE(aoid.tablename, relid\:\:regclass\:\:text)\n\t\tAND row_data->'id'\:\:text \= 'P_213576'\n\t)\n\n/\n\nselect * from bo_hardwood_deal_report\nwhere bo_contract_hardwood_fkey in(select id from bo_contract_hardwood_deal where main_deal_number\='0001004322012079430201220302')\n/\n\nSELECT *\nFROM history.logged_actions\nLIMIT 100\n/\n\nSELECT id, label_date, sign_date\nFROM bo_labels\n//WHERE sign_date IS NOT NULL\n-- ORDER BY label_date DESC\nWHERE id IN ('P_494081', 'P_493748', 'P_494082', 'P_494040', 'P_494061', 'P_494062')
4.0.tx=SELECT *\nFROM bo_system\n/\n\n-- http\://jira.taskdata.com/browse/EG-2751\nUPDATE bo_system\nSET\n\tbo_user_fkey \= (SELECT id FROM bo_user WHERE login \= 'admin')\n\t,api_key \= '111-222-333'\n\t,status \= 1 -- active\n\t,connection_limit \= 10\nWHERE\n\tlabel \= '\u0415\u0413\u0410\u0418\u0421'\n/\n\nINSERT INTO bo_system (id, bo_user_fkey, api_key, status, label, created_by, updated_by, create_date, update_date, connection_limit)\nVALUES ( 'T', (SELECT id FROM bo_user WHERE login \= 'test_oiv_22'), '222-333-444', 1 /*active*/, 'TEST SOAP', 'docker', 'docker', NOW(), NOW(), 2)\n/\n\nINSERT INTO bo_role_resource (id, role_fkey, secured_resource, create_date, update_date, source_system, source_key, created_by, updated_by)\nSELECT 'P_' || nextval('public.sq_bo_role_resource'), 'P_1', missing.secured_resource, current_timestamp, current_timestamp, 'P', 'P', 'auto_all', 'auto_all'\nFROM (\n\tSELECT DISTINCT secured_resource\n\tFROM bo_role_resource r\n\tWHERE\n\t\tNOT EXISTS (\n\t\t\tSELECT 1\n\t\t\tFROM bo_role_resource i\n\t\t\tWHERE role_fkey \= 'P_1' and i.secured_resource \= r.secured_resource\n\t\t)\n) missing\n/\n\n//////////////\n\nSELECT *\nFROM bo_contract_lease c\n\tJOIN bo_document_base b ON (b.id \= c.bo_document_fkey)\nWHERE c.id \= 'P_100'\n/\n\nSELECT s.name, *\nFROM bo_contract_lease c\n\tJOIN bo_document_base b ON(b.id \= c.bo_document_fkey)\n\tJOIN lu_status s ON (b.status \= s.id)\nWHERE c.id LIKE 'P_%'\n/\n\n//////////\nOpen area\n/\n\nDROP MATERIALIZED VIEW oa_contract_forest_works;\nDROP MATERIALIZED VIEW oa_contract_lease;\nDROP MATERIALIZED VIEW oa_contract_plants_sale;\nDROP MATERIALIZED VIEW oa_contract_use;\nDROP MATERIALIZED VIEW oa_contract_hardwood_deal;\nDROP MATERIALIZED VIEW oa_labels;\n\n/\nSELECT\n\tc.*, '||', b.*\nFROM bo_contract_hardwood_deal c\n\tJOIN bo_document_base b ON (b.id \= c.bo_document_fkey)\n//FROM bo_hardwood_deal_details\n/\n\nSELECT bo_party_seller_fkey, bo_party_buyer_fkey, main_deal_number, deal_number, COUNT(*)\nFROM\n\tbo_contract_hardwood_deal\nGROUP BY\n\tbo_party_seller_fkey, bo_party_buyer_fkey, main_deal_number, deal_number\nHAVING COUNT(*) > 1\n/\n\nSELECT\n\tbo_party_seller_fkey, bo_party_buyer_fkey, contract_num, contract_start_date, main_deal_number, deal_number, COUNT(*)\nFROM bo_contract_hardwood_deal c\n\tJOIN bo_document_base b ON (b.id \= c.bo_document_fkey)\nGROUP BY\n\tbo_party_seller_fkey, bo_party_buyer_fkey, contract_num, contract_start_date, main_deal_number, deal_number\nHAVING COUNT(*) > 1\n/\n\nSELECT\n\tcontract.id\n\t, contract.bo_document_fkey\n\t, contract.bo_party_buyer_fkey\n\t, contract.bo_party_seller_fkey\n\t, contract.buyer_info_date\n\t, contract.seller_info_date\n\t, contract.buyer_inn\n\t, contract.seller_inn\n\t, contract.deal_number\n\t, contract.main_deal_number\n\t, contract.is_buyer\n\t, contract.wood_storages\n\t, contract.buyer_sign_date\n\t, contract.seller_sign_date\n\t, contract.deal_type\n\t, contract.wood_type\n\t, contract.seller_signature\n\t, contract.buyer_signature\n\t, contract.seller_thumb_print\n\t, contract.buyer_thumb_print\n\t, contract.seller_signed_by\n\t, contract.buyer_signed_by\n\t, doc.registration_fail_reason\n\t, doc.contract_num\n\t, doc.contract_start_date\n\t, doc.contract_end_date\n\t, doc.doc_type_fkey\n\t, doc.lu_land_type_fkey\n\t, doc.status\n\t, doc.create_date\n\t, doc.update_date\n\t, doc.sign_date\n\t, doc.signal_status\n\t, src_sys.id AS source_system_id\n\t, src_sys.label AS source_system_label\n\t, (\tSELECT\n\t\t\tSUM(hardwood_volume) hardwood_volume \n\t\tFROM\n\t\t\tbo_hardwood_deal_details detail \n\t\tWHERE\n\t\t\tdetail.bo_contract_hardwood_fkey \= contract.id) AS wood_volume \nFROM\n\tbo_contract_hardwood_deal contract \n\t\tLEFT JOIN bo_party seller \n\t\tON seller.id \= contract.bo_party_seller_fkey \n\t\tAND seller.inn IN (?) \n\t\tLEFT JOIN bo_party buyer \n\t\tON buyer.id \= contract.bo_party_buyer_fkey \n\t\tAND buyer.inn IN (?) \n\t\tINNER JOIN bo_document_base doc \n\t\tON doc.id \= contract.bo_document_fkey \n\t\tINNER JOIN bo_system src_sys \n\t\tON doc.source_system \= src_sys.id \nWHERE\n\t(seller.id IS NOT NULL \n\tOR buyer.id IS NOT NULL) \n\tAND s1.hardwood_volume\=? \nORDER BY\n\tcontract.id LIMIT ? OFFSET ?\n/\n\n\nSELECT *\nFROM bo_document_base\n/\n\nALTER TABLE public.bo_contract_forest_declaration\n    ALTER COLUMN declaration_date_from TYPE TIMESTAMP WITH TIME ZONE USING declaration_date_from AT TIME ZONE 'MSK',\n    ALTER COLUMN receipt_date TYPE TIMESTAMP WITH TIME ZONE USING receipt_date AT TIME ZONE 'MSK' + interval '10 hours',\n    ALTER COLUMN declaration_date_to TYPE TIMESTAMP WITH TIME ZONE USING declaration_date_to AT TIME ZONE 'MSK';\n/\n\nSELECT *\nFROM bo_labels\nWHERE label_num \= 'EG-2596-test1'\n/\n\nSELECT *\nFROM bo_document_signal\nWHERE 1\=1\n// answer IS NOT null\n//\tdate IS null\n/\n\nSELECT bo_document_fkey\nFROM bo_document_signal\nGROUP BY bo_document_fkey\nHAVING COUNT(*) > 1\n\n/\nSELECT s.id, s.bo_document_fkey, b.contract_num, b.doc_type_fkey, dt.doc_type\nFROM bo_document_signal s\n\tJOIN bo_document_base b ON (b.id \= s.bo_document_fkey)\n\tJOIN lu_doc_type dt ON (dt.id \= b.doc_type_fkey)\n/\n\nSELECT -- there only single signal possible\!?\n\tDISTINCT MIN(b.id)\n\t,dt.doc_type\n\t,dt.id\n\t,processed\nFROM bo_document_signal s\n\tJOIN bo_document_base b ON (b.id \= s.bo_document_fkey)\n\tJOIN lu_doc_type dt ON (dt.id \= b.doc_type_fkey)\nWHERE\n\tb.id LIKE 'G_%' -- That ID match with contract table, to do not do additional lookup\nGROUP BY dt.doc_type, dt.id, processed\nORDER BY dt.id\n/\n\nSELECT\n\tc.id\n\t,ds.id\n\t, ds.message\n\t, ds.answer\n\t, ds.processed\n\t, ds.violation\n\t, ds.updated_by\n\t, ds.update_date \nFROM\n\tbo_document_signal ds\n\t, bo_contract_hardwood_deal C \nWHERE\n\tds.bo_document_fkey \= C.bo_document_fkey \n\tAND C.bo_document_fkey \= 'P_1593993'\nORDER BY\n\tds.create_date DESC\n/\n\nEXPLAIN ANALYZE\nSELECT\n\tb.id, b.contract_num, b.doc_type_fkey, dt.doc_type\nFROM\n\tbo_document_base b\n\tJOIN lu_doc_type dt ON (dt.id \= b.doc_type_fkey)\nORDER BY dt.doc_type\nLIMIT 100\n/\n\nCREATE INDEX tmp__bo_document_base__doc_type ON bo_document_base(doc_type_fkey)\n/\n\nCREATE INDEX tmp__lu_doc_type__id__doc_type ON lu_doc_type(id, doc_type)\n/\n\nSELECT *\nFROM bo_constituent_entity\n\n/\n\nSELECT *\nFROM bo_federal_district\n/\n\nSELECT *\nFROM bo_forestry\n/\n\nSELECT\n\tnextval('sq_bo_contract_lease')\nFROM generate_series(1, 10)\n/\n\nSELECT *\nFROM generate_series(1, 10)\n/\n\nSELECT *\nFROM lu_reason_type\n/\n\nSELECT *\nFROM bo_tract\nWHERE bo_sub_forestry_fkey \= 'G_U6136'\n/\n\nSELECT bo_sub_forestry_fkey, COUNT(*)\nFROM bo_tract\nGROUP BY bo_sub_forestry_fkey\n\n/\nSELECT *\nFROM bo_sub_forestry\nWHERE id \= 'P_180'\n/\n\nSELECT *\nFROM lu_production_calendar\n/\n\nALTER TABLE public.lu_production_calendar\n ALTER COLUMN specified_date TYPE DATE USING specified_date AT TIME ZONE 'MSK';\n/\n\nINSERT INTO bo_system (id, bo_user_fkey, api_key, status, label, created_by, updated_by, create_date, update_date, connection_limit)\nVALUES ( 'T', (SELECT id FROM bo_user WHERE login \= 'test_oiv_22'), '222-333-444', 1 /*active*/, 'TEST SOAP', 'docker', 'docker', NOW(), NOW(), 2)\n--ON CONFLICT DO NOTHING;\n/\n\nDELETE\nFROM bo_party\nWHERE inn \= '6323053258'\n/\n\nWITH ids AS (\n\tSELECT id\n    FROM bo_party\n    WHERE inn \= '2221004857'\n),del_rel AS (\n\tDELETE\n    FROM rel_user_party_favorites\n    WHERE bo_party_fkey IN (SELECT id FROM ids)\n)\nDELETE\nFROM bo_party\nWHERE id IN (SELECT id FROM ids)\n/\n\nSELECT *\nFROM bo_labels\nWHERE id \= 'P_217953'\n/\n\nSELECT *\nFROM bo_hardwood_deal_report\n/\n\nSELECT *\nFROM bo_document_base\n/\n\nSELECT * FROM schema_version\n/\n\nSET timezone \= 'europe/Moscow';\nSELECT id, contract_num, create_date, update_date, client_create_time\n--\t,contract_start_date, contract_end_date, receipt_date\n\t,*\n--\t,create_date AT TIME ZONE 'MSK', update_date AT TIME ZONE 'MSK', client_create_time AT TIME ZONE 'MSK'\nFROM bo_document_base\nORDER BY create_date DESC NULLS LAST\nLIMIT 10\n/\n\nSHOW timezone\n/\n\nSET timezone \= 'europe/Moscow';\nSELECT b.id, contract_num, create_date, update_date, client_create_time\n\t,c.receipt_date\n--\t,*\n--\t,create_date AT TIME ZONE 'MSK', update_date AT TIME ZONE 'MSK', client_create_time AT TIME ZONE 'MSK'\nFROM bo_document_base b\n\tJOIN bo_contract_permanent c ON (c.bo_document_fkey \= b.id)\nORDER BY create_date DESC NULLS LAST\nLIMIT 10\n/\n\n--------------------------------\n/*\n  FOREIGN KEY\: bo_document_underlying_fkey (bo_document_underlying_fkey) references bo_document_base(id)\n  FOREIGN KEY\: bo_hardwood_deal_fkey (bo_hardwood_deal_fkey) references bo_contract_hardwood_deal(id)\n*/\n\nSELECT\n//\t*\n\td.id, rel.bo_hardwood_deal_fkey, rel.bo_document_underlying_fkey\nFROM\n\tbo_contract_hardwood_deal d\n\t-- Underlying documents\:\n\tJOIN rel_hardwood_deal_contract rel ON (rel.bo_hardwood_deal_fkey \= d.id)\n\tJOIN bo_document_base und ON (und.id \= rel.bo_document_underlying_fkey)\nWHERE\n//\td.id \= 'P_86069'\n\trel.bo_document_underlying_fkey \= 'P_86069'\n/\n\nSELECT\n\tund.bo_hardwood_deal_fkey, und.bo_document_underlying_fkey, und_c.c_id as under_contract_id, und_c.b_id as under_base_id, und_c.enum\nFROM\n\trel_hardwood_deal_contract und\n\tLEFT JOIN v_contracts und_c ON (und_c.b_id \= und.bo_document_underlying_fkey)\nWHERE\n//\tund.bo_document_underlying_fkey \= 'P_86069'\n//\tund.bo_document_underlying_fkey IN (SELECT bo_document_fkey FROM bo_contract_hardwood_deal)\n\tund.bo_hardwood_deal_fkey \= 'P_217343'\n//\tund.bo_document_underlying_fkey IN ('P_2356130', 'P_2356131', 'P_2356132')\n/\n\nSELECT *\nFROM v_contracts\nWHERE\n-- b_id \= 'P_86069'\n\tb_id IN ('P_2356130', 'P_2356131', 'P_2356132')\nORDER BY\n\tb_id\n/\n\nSELECT *\nFROM bo_party WHERE id \= 'P_841140'\n/\n\n-- \u0421\u0434\u0435\u043B\u043A\u0438, \u043E\u0441\u043D\u043E\u0432\u0430\u043D\u0438\u044F\u043C\u0438 \u043A\u043E\u0442\u043E\u0440\u044B\u0445 \u044F\u0432\u043B\u044F\u044E\u0442\u0441\u044F \u0434\u0440\u0443\u0433\u0438\u0435 \u0441\u0434\u0435\u043B\u043A\u0438 (\u0446\u0435\u043F\u043E\u0447\u043A\u0430 +1 \u0448\u0430\u0433)\nSELECT\n\trel.bo_hardwood_deal_fkey, d.bo_document_fkey, rel.bo_document_underlying_fkey, und_dt.enum as under_type, 0, ARRAY[rel.bo_hardwood_deal_fkey\:\:text], false\n\t,d.bo_party_seller_fkey, d.bo_party_buyer_fkey\nFROM\n\trel_hardwood_deal_contract rel\n\tJOIN bo_document_base und_b ON (und_b.id \= rel.bo_document_underlying_fkey)\n\tJOIN lu_doc_type und_dt ON (und_dt.id \= und_b.doc_type_fkey)\n\tJOIN bo_contract_hardwood_deal d ON (d.id \= rel.bo_hardwood_deal_fkey)\n\tJOIN bo_document_base d_b ON (d_b.id \= d.bo_document_fkey)\nWHERE 1\=1\n//\t\tbo_party_buyer_fkey \= 'P_165919' -- \u041E\u0431\u0449\u0435\u0441\u0442\u0432\u043E \u0441 \u043E\u0433\u0440\u0430\u043D\u0438\u0447\u0435\u043D\u043D\u043E\u0439 \u043E\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043D\u043D\u043E\u0441\u0442\u044C\u044E "\u0413\u0410\u0420\u0410\u041D\u0422 \u0418\u041B\u0418\u041C"\n\tAND d.bo_party_buyer_fkey \= 'P_841140' -- DEBUG value. Start point\n//\tAND rel.bo_document_underlying_fkey \= 'P_1981767'\n//\tAND rel.bo_document_underlying_fkey \= 'P_2076787'\n//\tAND rel.bo_document_underlying_fkey \= 'P_155135'\n//\tAND d.bo_document_fkey \= 'P_2048899'\n\tAND d_b.status \= 2 -- signed only\n//\tAND und_dt.enum \= 'CONTRACT_HARDWOOD_DEAL' -- Start graph from Deals which have underlying other types of documents\n/\n\n2 \u0441\u0434\u0435\u043B\u043A\u0438 (c_id\:b_id)\:\n1) P_135971\:P_1981767, \u043E\u0441\u043D\u043E\u0432\u0430\u043D\u0438\u0435 (b_id)\: P_171455  CONTRACT_LEASE\n\tP_1981767 \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u043E\u0441\u043D\u043E\u0432\u0430\u043D\u0438\u0435\u043C \u0434\u043B\u044F \u0434\u0440\u0443\u0433\u0438\u0445 \u0441\u0434\u0435\u043B\u043E\u043A\n2) P_155135\:P_2076787, \u043E\u0441\u043D\u043E\u0432\u0430\u043D\u0438\u0435 (b_id)\: P_2048899 CONTRACT_HARDWOOD_DEAL\n\tP_2076787 \u0442\u043E\u0436\u0435 \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u043E\u0441\u043D\u043E\u0432\u0430\u043D\u0438\u0435\u043C \u0434\u043B\u044F \u0434\u0440\u0443\u0433\u0438\u0445 \u0441\u0434\u0435\u043B\u043E\u043A\n/\n\nSELECT *\nFROM v_contracts\nWHERE b_id \= 'P_2048899' -- \u0441\u0434\u0435\u043B\u043A\u0430 - \u043E\u0441\u043D\u043E\u0432\u0430\u043D\u0438\u0435
